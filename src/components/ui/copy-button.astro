---
// biome-ignore lint/correctness/noUnusedVariables: Used in template below
interface Props {
	code: string;
	class?: string;
}

// biome-ignore lint/correctness/noUnusedVariables: Used in template below
const { code, class: className } = Astro.props;
---

<button
	type="button"
	class={`copy-button ${className || ""}`}
	data-code={code}
	aria-label="コードをコピー"
>
	<svg class="copy-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
		<rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
		<path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path>
	</svg>
	<svg class="check-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
		<path d="M20 6 9 17l-5-5"></path>
	</svg>
	<span class="copy-text">Copy</span>
</button>

<style>
	.copy-button {
		position: relative;
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		padding: 0.5rem 0.75rem;
		font-size: 0.875rem;
		font-weight: 500;
		color: var(--sl-color-text-accent, #64748b);
		background: transparent;
		border: 1px solid var(--sl-color-hairline, #e2e8f0);
		border-radius: 0.375rem;
		cursor: pointer;
		transition: all 0.2s ease;
	}

	.copy-button:hover {
		color: var(--sl-color-text, #0f172a);
		background: var(--sl-color-bg-inline-code, #f8fafc);
		border-color: var(--sl-color-text-accent, #94a3b8);
	}

	.copy-button:active {
		transform: scale(0.95);
	}

	.check-icon {
		display: none;
	}

	.copy-button.copied .copy-icon {
		display: none;
	}

	.copy-button.copied .check-icon {
		display: block;
	}

	.copy-button.copied {
		color: var(--sl-color-green, #22c55e);
		border-color: var(--sl-color-green, #22c55e);
	}

	@media (prefers-color-scheme: dark) {
		.copy-button {
			color: var(--sl-color-text-accent, #94a3b8);
			border-color: var(--sl-color-hairline, #334155);
		}

		.copy-button:hover {
			color: var(--sl-color-text, #f1f5f9);
			background: var(--sl-color-bg-inline-code, #1e293b);
			border-color: var(--sl-color-text-accent, #64748b);
		}
	}
</style>

<script>
	document.addEventListener("astro:page-load", () => {
		const buttons = document.querySelectorAll(".copy-button");

		buttons.forEach((button) => {
			if (button instanceof HTMLButtonElement) {
				button.addEventListener("click", async () => {
					const code = button.dataset.code;
					if (!code) return;

					try {
						await navigator.clipboard.writeText(code);

						// コピー成功のフィードバック
						button.classList.add("copied");
						setTimeout(() => {
							button.classList.remove("copied");
						}, 2000);
					} catch (err) {
						console.error("Failed to copy:", err);
					}
				});
			}
		});
	});
</script>
